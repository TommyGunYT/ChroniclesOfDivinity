Version 1
SubGoalCombiner SGC_AND
INITSECTION
//REGION USEFUL SCRIPTS / FOR LATER USE
//ApplyStatus(_Player,"QUEST_TIEDUP",-1.0);
//CharacterSetAnimationOverride(_Player,"Tied_Up_01_Loop");
// RS3_FX_SK_Soul_Ghosts_01 | GHOST EFFECT |
// RS3_FX_SubEffects_KrakenRay_LightningArcs_01 (Environmental effect)
// Beam Particle AOE effect  RS3_FX_GP_Status_MagicShell_01
// RS3_FX_GP_Status_Shocked_01
//END_REGION
DB_DCCompanionTemps(CHARACTERGUID_DC_NPC_Icara_001_ac205041-f93f-4e4d-babf-6db6bd588e15);
KBSECTION
IF
RegionStarted("FJ_FortJoy_Main")
THEN
ActivatePersistentLevelTemplate(LEVELTEMPLATEGUID_DC_FortJoy_Isles_b3b190eb-a87b-44e9-b3ac-b114935dafcb);


//REGION DEBUG TOOL
IF
CharacterUsedItemTemplate(_Player, "DC_BOOK_TutorialShip_TimeTravel_baec138a-3f8d-4252-8c22-a3c70f31a464", _Item)
THEN
DisplayText(_Player,"Running Teleporter Dialogue!");
PlaySound(_Player,"SE_Lohse_song_full_performance");
Proc_StartDialog(0,"Icara_Teleport",CHARACTERGUID_DC_Icara_Teleporter_ea4b5b68-d341-4518-b802-08e18900236c,_Player);
//END_REGION

//REGION DEBUG RECRUITMENT
IF
GlobalFlagSet("DC_RecruitFullTempParty")
THEN
Proc_DebugRecruitParty();

PROC
Proc_DebugRecruitParty()
AND
DB_IsPlayer(_Player)
AND
GetPosition(_Player, _X, _Y, _Z)
AND
CharacterCreateAtPosition(_X, _Y, _Z, "CHARACTERGUID_GLO_Saheila_PostFTJ_10b71425-00b2-4668-b1df-227d254c7ae2", 0, _TempDebugCompanion)
AND
CharacterCreateAtPosition(_X, _Y, _Z, "CHARACTERGUID_Elves_Female_Malady_cbc79f47-50a1-4837-9d09-fcbd7b75a919", 0, _TempDebugCompanion)
AND
CharacterCreateAtPosition(_X, _Y, _Z, "CHARACTERGUID_Animals_Dog_B_b6a6c50d-ca6a-456f-ad81-9a72b081e4b5", 0, _TempDebugCompanion)
AND
CharacterGetReservedUserID((CHARACTERGUID)_Player, _User)
THEN
DB_TempDebugCompanion(_TempDebugCompanion);
TimerLaunch("RecruitTempCharsDC", 500);

IF
TimerFinished("RecruitTempCharsDC")
AND
DB_IsPlayer(_Player)
AND
DB_TempDebugCompanion(_TempDebugCompanion)
AND
CharacterGetReservedUserID((CHARACTERGUID)_Player, _User)
THEN
ProcRemoveAllDialogEntriesForSpeaker((CHARACTERGUID)_TempDebugCompanion);
CharacterMakePlayer((CHARACTERGUID)_TempDebugCompanion, _Player);
DB_IsPlayer((CHARACTERGUID)_TempDebugCompanion);
CharacterAssignToUser(_User, (CHARACTERGUID)_TempDebugCompanion);
CharacterAddToParty((CHARACTERGUID)_TempDebugCompanion, _Player);
GlobalClearFlag("DC_RecruitFullTempParty");
//END_REGION

//REGION Source Points Override
IF
CharacterUsedItemTemplate((CHARACTERGUID)_Player, "DC_CON_Potion_Source_a5fdf6a5-a170-4598-9652-850977dc362d", (ITEMGUID)_Item)
AND
CharacterGetMaxSourcePoints(_Player, (INTEGER)_CurrentSP)
AND
IntegerSum(_CurrentSP, 1, (INTEGER)_MaxSP)
THEN
CharacterOverrideMaxSourcePoints(_Player, _MaxSP);

// Increase Source Point by 1
IF
CharacterUsedItemTemplate((CHARACTERGUID)_Player, "DC_Quest_SourcePointScroll_000_56e7c888-7929-47c7-aa95-8a1838256783", (ITEMGUID)_Item)
AND
CharacterGetMaxSourcePoints(_Player, (INTEGER)_CurrentSP)
AND
IntegerSum(_CurrentSP, 1, (INTEGER)_MaxSP)
THEN
CharacterAddSourcePoints((CHARACTERGUID)_Player,1);
//END_REGION

//REGION TRAVEL AGENCY FOR PLAYTESTING
IF
GlobalFlagSet("TP_Isles_Main")
THEN
CharacterTeleportPartiesToTrigger(TRIGGERGUID_DC_TP_FTJ_Isles_BeachMain_fda011da-df2c-4696-868b-a9fe5591df55,"");
GlobalClearFlag("TP_Isles_Main");

IF
GlobalFlagSet("TP_Isles_DragonIsland")
THEN
CharacterTeleportPartiesToTrigger(TRIGGERGUID_DC_TP_FTJ_Isles_DragonIsland_7e24ada7-03ce-414e-9c3a-eb18c9c418f6,"");
GlobalClearFlag("TP_Isles_DragonIsland");
//END_REGION

//REGION DEBUG Book
IF
GlobalFlagSet("DC_DEBUG_KaraToFTJ")
AND
CharacterIsControlled(CHARACTERGUID_S_Player_Kara_bcf8286e-213c-438d-b622-b6e40add12dd, 0)
THEN
TeleportTo(CHARACTERGUID_S_Player_Kara_bcf8286e-213c-438d-b622-b6e40add12dd, TRIGGERGUID_DC_Kara_StartPoint_9f4326f0-68c4-4aab-84de-0f412c8dd979);
//END_REGION



IF
CharacterUsedItem(_Player,ITEMGUID_DC_Sandbox_Lever_cf25673d-0e86-40ff-83fb-34bd0315862a)
AND
GetRandomPositionInTrigger(TRIGGERGUID_DC_Sandbox_BoxTrigger_a0e613a6-f155-49f7-88f6-59d6fc1a4763,_bX,_bY,_bZ)
AND
CharacterCreateAtPosition(_bX,_bY,_bZ,"CHARACTERGUID_Animals_Rabbit_A_ebd3b174-0bf0-464f-948d-8ea5f13d3a81",1,_RNDRabbit)
THEN
DB_BoomRabbits(_RNDRabbit);
Proc_SandboxLever1();

PROC
Proc_SandboxLever1()
AND
GetPosition(ITEMGUID_S_DC_StandingTorch_Osiris_e4c7e09b-676d-40c8-a0bc-dd6417b37952,_X,_Y,_Z)
AND
CharacterCreateAtPosition(_X,_Y,_Z,"Helper_Invisible_A_Character_a157953f-8e80-4c98-b227-12fd3f6cb7bb",0,_InviChar)
THEN
CharacterUseItem(_InviChar,ITEMGUID_S_DC_StandingTorch_Osiris_e4c7e09b-676d-40c8-a0bc-dd6417b37952,"LightTorchTest");
DB_DCInviChar(_InviChar);
TimerLaunch("InviCharUseTorch",100);

IF
TimerFinished("InviCharUseTorch")
AND
DB_DCInviChar(_InviChar)
THEN
CharacterDieImmediate(_InviChar, 0, "DoT");
NOT DB_DCInviChar(_InviChar);


IF
CharacterUsedItem(_Player,ITEMGUID_DC_Sandbox_Lever_Boom_656ee691-a96f-4f84-aa5b-23b3923c1e01)
AND
DB_BoomRabbits(_RNDRabbit)
AND
GetPosition(_RNDRabbit,_rX,_rY,_rZ)
THEN
CharacterDie(_RNDRabbit,0,"Explode");
PlayEffectAtPosition("RS3_FX_GP_ScriptedEvent_Lightning_Vertical_01",_rX,_rY,_rZ);
UnlockSecretRegion(TRIGGERGUID_SecretRegionTrigger_000_117f85c7-0f28-4636-a01b-5c3ddb614853);
NOT DB_BoomRabbits(_RNDRabbit);

IF
CharacterUsedItem(_Player,ITEMGUID_PUZ_Lever_Floor_D_000_b51595f4-9e2f-446b-9822-5cc6ff810a88)
AND
DB_DCCompanionTemps(_tempcompanion)
THEN
Proc_AssignNpcToPlayer((CHARACTERGUID)_player, (CHARACTERGUID)_tempcompanion);


PROC
Proc_AssignNpcToPlayer((CHARACTERGUID)_player, (CHARACTERGUID)_tempcompanion)
AND
DB_DCCompanionTemps(_tempcompanion)
AND
CharacterGetReservedUserID((CHARACTERGUID)_player, _user)
THEN
ProcRemoveAllDialogEntriesForSpeaker(_tempcompanion);
CharacterMakePlayer(_tempcompanion, _player);
DB_IsPlayer(_tempcompanion);
CharacterAssignToUser(_user, (CHARACTERGUID)_tempcompanion);
DB_IsPlayer((CHARACTERGUID)_tempcompanion);

PROC
Proc_AssignNpcToPlayer((CHARACTERGUID)_player, (CHARACTERGUID)_tempcompanion)
AND
DB_DCCompanionTemps(_tempcompanion)
THEN
CharacterAddToParty(_tempcompanion, _player);

IF
CharacterUsedItem(_Player, ITEMGUID_PUZ_Lever_Floor_E_000_639f9f7b-da9c-4865-aa42-4134314fc36d)
THEN
CharacterTeleportPartiesToTrigger(TRIGGERGUID_DC_TP_FTJ_Isles_BeachMain_fda011da-df2c-4696-868b-a9fe5591df55, "");




IF
DialogEnded("GEN_Debug_Item", _ID)
AND
DB_IsPlayer(_Character)
AND
ItemTemplateIsInCharacterInventory(_Character, "DC_Debug_Book_b7e7be57-2940-4260-885f-af92912b1657", 0)
THEN
ItemTemplateAddTo("DC_Debug_Book_b7e7be57-2940-4260-885f-af92912b1657", _Character, 1);


IF
CharacterUsedItem(_Player, ITEMGUID_PUZ_Lever_Floor_D_000_e1202aee-e67c-4077-8602-8845c9ee8f69)
AND
GetPosition(_Player, _X, _Y, _Z)
THEN
ItemMoveToPosition(TRIGGERGUID_SpectatorCameraTrigger_004_f966d54c-451e-474c-8892-5e5ffc4336b5, _X, _Y, _Z, 50.00, 0.00, "");
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "__Start"
