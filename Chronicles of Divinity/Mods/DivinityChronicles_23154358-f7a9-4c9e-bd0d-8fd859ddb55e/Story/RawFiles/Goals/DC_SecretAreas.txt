Version 1
SubGoalCombiner SGC_AND
INITSECTION
CharacterUseItem(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,ITEMGUID_S_DC_SeekerCave_Chair_4a389445-2d81-8e0c-298c-c276a1708209,"");
ItemTemplateAddTo("ITEMGUID_DC_SeekerCavern_Key_a879c361-307e-423e-bef6-5243bd92f775",CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,1);
SetOnStage(ITEMGUID_DC_SeekerCave_Bucket_2144d42d-0bdd-4efc-a9fa-8be1b9883b01,0);

TriggerRegisterForPlayers(TRIGGERGUID_S_DC_SeekerCamp_CrimeArea_31279eca-a07d-4e93-be1b-da016799ae3d);

DB_DC_SeekerCave_SneakTrigger(TRIGGERGUID_DC_SeekerCavern_StairsApproached_d06b717b-57af-49ac-be77-5e544a312a1a);
DB_DC_SeekerCave_SneakTrigger(TRIGGERGUID_DC_SeekerCavern_StairsApproached_000_e278f2ec-5dba-48c9-a498-5fac555d22d9);
DB_DC_SeekerCave_SneakTrigger(TRIGGERGUID_DC_SeekerCavern_StairsApproached_001_7f216029-7ad0-4888-8f2c-75d4e6645757);
DB_DC_SeekerCave_SneakTrigger(TRIGGERGUID_DC_SeekerCavern_StairsApproached_002_c47301dd-e31e-4a0b-af20-3b7a2191ee2a);
KBSECTION
//REGION SEEKER CAMP | WELL


IF
CharacterUsedItem(_Player,ITEMGUID_DC_WellBucket_SeekerCamp_c92f97e7-c126-43ba-8c18-4bbc40e36e79)
AND
DB_IsPlayer(_Player)
THEN
Proc_StartDialog(0,"SeekerWellBucket",ITEMGUID_DC_WellBucket_SeekerCamp_c92f97e7-c126-43ba-8c18-4bbc40e36e79,_Player);

IF
GlobalFlagSet("SeekerWellBucketPushed")
AND
GetPosition(ITEMGUID_DC_WellBucket_SeekerCamp_c92f97e7-c126-43ba-8c18-4bbc40e36e79,_X,_Y,_Z)
THEN
PlaySound(ITEMGUID_BLD_Humans_Farm_WaterWell_A_000_3ae6ac59-c29d-4814-a3b9-52992fd63cbd,"Item_Weapon_Wood_Small_Drop");
ItemDestroy(ITEMGUID_DC_WellBucket_SeekerCamp_c92f97e7-c126-43ba-8c18-4bbc40e36e79);
PlayEffectAtPosition("RS3_FX_GP_ScriptedEvent_Teleport_GenericSmoke_01",_X,_Y,_Z);
TimerLaunch("SeekerBucketTimer",900);

IF
TimerFinished("SeekerBucketTimer")
THEN
PlaySound(ITEMGUID_BLD_Humans_Farm_WaterWell_A_000_3ae6ac59-c29d-4814-a3b9-52992fd63cbd,"Amb_Point_Dungeon_MetalHits_1");
TimerLaunch("SeekerBucketTimer2",850);

IF
TimerFinished("SeekerBucketTimer2")
THEN
PlaySound(ITEMGUID_BLD_Humans_Farm_WaterWell_A_000_3ae6ac59-c29d-4814-a3b9-52992fd63cbd,"Items_Objects_Destroy");
TimerLaunch("SeekerBucketTimer3",750);

IF
TimerFinished("SeekerBucketTimer3")
THEN
PlaySound(ITEMGUID_BLD_Humans_Farm_WaterWell_A_000_3ae6ac59-c29d-4814-a3b9-52992fd63cbd,"KillingBlow_04");
//END_REGION

//REGION SEEKER CAVE
// Bucket drops on Bjorn's head and knocks him out.
IF
GlobalFlagSet("SeekerWellBucketPushed")
THEN
ProcCharacterMoveTo(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,TRIGGERGUID_DC_SeekerCavern_KnockoutPoint_109133cb-669e-48a2-b55d-afc1fc87be0e,0,"DC_BjornToKnockOutPoint");

IF
StoryEvent(_,"DC_BjornToKnockOutPoint")
THEN
SetOnStage(ITEMGUID_DC_SeekerCave_Bucket_2144d42d-0bdd-4efc-a9fa-8be1b9883b01,1);
ApplyStatus(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,"KNOCKED_DOWN",-1.0);

// Player enters the cavern while Bjorn is still conscious

//REGION BJORN Activity
IF
CharacterEnteredTrigger(_Player,TRIGGERGUID_DC_SeekerCavern_Entered_f8de447c-1877-49ee-addb-20301dca5f3c)
AND
GlobalGetFlag("SeekerWellBucketPushed",0)
AND
GlobalGetFlag("PlayerInSeekerCavern",0)
THEN
GlobalSetFlag("PlayerInSeekerCavern");
TimerLaunch("BjornTimer1",20000);

IF
TimerFinished("BjornTimer1")
AND
GlobalGetFlag("BjornSawPlayer",0)
AND
GlobalGetFlag("SeekerWellBucketPushed",0)
THEN
ProcCharacterMoveTo(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,TRIGGERGUID_DC_SeekerCavern_ChairByDiningTable_a9ee4f86-12fa-472d-9b36-51ac864e5c36,0,"DC_BjornToDiningTable");

IF
StoryEvent(_,"DC_BjornToDiningTable")
AND
GlobalGetFlag("BjornSawPlayer",0)
THEN
CharacterUseItem(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,ITEMGUID_S_DC_SeekerCavern_DiningChair_56293af0-e6a4-8eb0-174c-25fd9a125aab,"");
TimerLaunch("BjornTimer2",18500);

IF
CharacterUsedItem(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,ITEMGUID_S_DC_SeekerCavern_DiningChair_56293af0-e6a4-8eb0-174c-25fd9a125aab)
THEN
CharacterSetAnimationOverride(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,"Dwarves_Hero_Male_ABC_Sit_Use_Eat_01");

IF
TimerFinished("BjornTimer2")
AND
GlobalGetFlag("SeekerWellBucketPushed",0)
THEN
ProcCharacterMoveTo(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,TRIGGERGUID_DC_SeekerCavern_KnockoutPoint_109133cb-669e-48a2-b55d-afc1fc87be0e,0,"DC_BjornToDesk");

IF
StoryEvent(_,"DC_BjornToDesk")
AND
GlobalGetFlag("BjornSawPlayer",0)
THEN
CharacterUseItem(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,ITEMGUID_S_DC_SeekerCave_Chair_4a389445-2d81-8e0c-298c-c276a1708209,"");
TimerLaunch("BjornTimer1",15000);
//END_REGION

IF
CharacterEnteredTrigger(_Player,_SneakTrigger)
AND
DB_IsPlayer(_Player)
AND
DB_DC_SeekerCave_SneakTrigger(_SneakTrigger)
AND
CharacterCanSee(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,_Player,1)
AND
ObjectIsInTrigger(_Player,TRIGGERGUID_DC_SeekerCavern_Check_cf857d0b-dc86-4786-9579-f0333603be7f,1)
AND
GlobalGetFlag("SeekerWellBucketPushed",0)
AND
GlobalGetFlag("BjornSawPlayer",0)
THEN
DisplayText(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,"Huh... You ain't supposed to be here!");
GlobalSetFlag("BjornSawPlayer");
ProcCharacterMoveTo(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,TRIGGERGUID_DC_SeekerCavern_PastGates_2c99956d-13b6-4381-a3a7-ddcd8c8695fe,1,"DC_BjornToIsolation");

IF
CharacterLeftTrigger(_Player,_SneakTrigger)
AND
DB_IsPlayer(_Player)
AND
DB_DC_SeekerCave_SneakTrigger(_SneakTrigger)
AND
CharacterCanSee(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,_Player,1)
AND
ObjectIsInTrigger(_Player,TRIGGERGUID_DC_SeekerCavern_Check_cf857d0b-dc86-4786-9579-f0333603be7f,1)
AND
GlobalGetFlag("SeekerWellBucketPushed",0)
AND
GlobalGetFlag("BjornSawPlayer",0)
THEN
DisplayText(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,"Huh... You ain't supposed to be here!");
GlobalSetFlag("BjornSawPlayer");
ProcCharacterMoveTo(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,TRIGGERGUID_DC_SeekerCavern_PastGates_2c99956d-13b6-4381-a3a7-ddcd8c8695fe,1,"DC_BjornToIsolation");

IF
StoryEvent(_,"DC_BjornToIsolation")
THEN
ItemCloseAndLock(ITEMGUID_DC_SeekerCavern_Door_165bb390-2fb4-85ab-48cb-d80c0c5b89e9,"DC_SeekerCavern");
//END_REGION

IF
GlobalFlagSet("PlayerInSeekerCavern")
AND
DB_IsPlayer(_Player)
AND
ObjectIsInTrigger(_Player,TRIGGERGUID_DC_SeekerCavern_Check_cf857d0b-dc86-4786-9579-f0333603be7f,1)
AND
CharacterCanSee(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,(CHARACTERGUID)_Player,1)
THEN
DisplayText(_Player,"Global Flag Can See too!");

IF
CharacterUsedItem(_Player,ITEMGUID_DC_SeekerCavern_Inside_dd291318-a882-8023-3476-f3a30f67992b)
AND
DB_IsPlayer(_Player)
AND
GlobalGetFlag("SeekerWellBucketPushed",0)
AND
ObjectIsInTrigger(_Player,TRIGGERGUID_DC_SeekerCavern_Check_cf857d0b-dc86-4786-9579-f0333603be7f,0)
THEN
GlobalClearFlag("BjornSawPlayer");
ItemUnlockAndOpen(ITEMGUID_DC_SeekerCavern_Door_165bb390-2fb4-85ab-48cb-d80c0c5b89e9);
ProcCharacterMoveTo(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,TRIGGERGUID_DC_SeekerCavern_ChairByDiningTable_a9ee4f86-12fa-472d-9b36-51ac864e5c36,0,"DC_BjornToDiningTable");


IF
DialogStartRequested(CHARACTERGUID_DC_BjornTheSilent_d387bd0f-d93a-4182-a47b-ef880cd4d61a,_Player)
AND
GlobalGetFlag("BjornSawPlayer",1)
THEN
DisplayText(_Player,"Dialog Started!");
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "FortJoy"
