Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_Subregion(TRIGGERGUID_DC_SUBREGION_SanctuaryPath_Main_549361c7-a440-4945-a31c-067ebabe2355,"DC_LV_SanctuaryPath",0);
DB_Dialogs(CHARACTERGUID_Mysterious_Deer_0068ade8-3b2e-42bb-b8d2-23e1caf5d1c8,"Mysterious_Deer");
TriggerRegisterForPlayers(TRIGGERGUID_DC_ReturnedToHoEMain_77d87513-0938-4b8c-8962-cf5e67b326a8);
TriggerRegisterForPlayers(TRIGGERGUID_DC_ArrivedHoEGods_32da3a4e-6f68-4497-9962-38806460d703);
		
DB_SourceFountains(ITEMGUID_HoE_Source_Fountain_e81889f7-dedf-4e73-9c0c-f04ad157d0b7,TRIGGERGUID_DC_HoE_SourcePoolSpawn_5bfe0da7-ede8-4717-8ed8-c6da9d96294a);
		
DB_QuestDef_State("TheTimeWeavers","HoEArrival",1);
DB_QuestDef_State("TheTimeWeavers","MetDeer");
DB_QuestDef_State("TheTimeWeavers","DeerTeleportedMe");
DB_QuestDef_State("TheTimeWeavers","HoEMainExit");
		
DB_Subregion(TRIGGERGUID_S_LV_HoE_SUB_GodRoom_001_e937bd81-971f-4ae7-9ac9-829c8b61858f,"LV_HoE_SUB_HoE",0);
DB_Subregion(TRIGGERGUID_S_LV_HoE_SUB_TreeArea_ebc5ba90-1adf-40c8-aa14-a2a980b99865,"LV_HoE_SUB_TreeArea",0);
DB_Subregion(TRIGGERGUID_S_LV_HoE_SUB_LadyVengeanceInHoE_4964e348-3891-4a7b-ba5a-06c965c6ca38,"LV_HoE_SUB_LadyVengeanceInHoE",0);
		
ProcDeclareCounter("LV_HoE_InvolvedPlayerCount");
ProcDeclareCounter("LV_HoE_PlayersInCavern");
		
DB_LV_HoE_DeadGods((CHARACTERGUID)CHARACTERGUID_S_LV_HoE_TirCendelius_6c131637-366e-43f1-a005-7b45786e2aa6);
DB_LV_HoE_DeadGods((CHARACTERGUID)CHARACTERGUID_S_LV_HoE_Duna_aedde842-f1bc-4ec5-9c4f-897c4ed5058c);
DB_LV_HoE_DeadGods((CHARACTERGUID)CHARACTERGUID_S_LV_HoE_Rhalic_8bb114d4-47de-413d-80a7-52b3f5e08b28);
DB_LV_HoE_DeadGods((CHARACTERGUID)CHARACTERGUID_S_LV_HoE_Lohse_bfc36e1e-9e18-4dea-811c-3522fb87ce93);
DB_LV_HoE_DeadGods((CHARACTERGUID)CHARACTERGUID_S_LV_HoE_Amadia_2bdb57d7-9a6a-44d0-a839-94ccb04a3106);
DB_LV_HoE_DeadGods((CHARACTERGUID)CHARACTERGUID_S_LV_HoE_ZorlStissa_929bcf83-ac27-4007-95a3-d34edaf8bcbe);
DB_LV_HoE_DeadGods((CHARACTERGUID)CHARACTERGUID_S_LV_HoE_OrcGod_ed633ff7-9e03-4fbb-af50-47196c89cc13);
		
		
		
DB_Dialogs(CHARACTERGUID_S_LV_HoE_Amadia_2bdb57d7-9a6a-44d0-a839-94ccb04a3106,"LV_HoE_God_Amadia");
DB_Dialogs(CHARACTERGUID_S_LV_HoE_Duna_aedde842-f1bc-4ec5-9c4f-897c4ed5058c,"LV_HoE_God_Duna");
DB_Dialogs(CHARACTERGUID_S_LV_HoE_Rhalic_8bb114d4-47de-413d-80a7-52b3f5e08b28,"LV_HoE_God_Rhalic");
DB_Dialogs(CHARACTERGUID_S_LV_HoE_TirCendelius_6c131637-366e-43f1-a005-7b45786e2aa6,"LV_HoE_God_TirCendelius");
DB_Dialogs(CHARACTERGUID_S_LV_HoE_ZorlStissa_929bcf83-ac27-4007-95a3-d34edaf8bcbe,"LV_HoE_God_ZorlStissa");
DB_Dialogs(CHARACTERGUID_S_LV_HoE_OrcGod_ed633ff7-9e03-4fbb-af50-47196c89cc13,"LV_HoE_God_Vrogir");
DB_Dialogs(CHARACTERGUID_S_LV_HoE_ImpGod_bfc36e1e-9e18-4dea-811c-3522fb87ce93,"LV_HoE_God_Xantezza");
		
		
DB_LV_HoE_GodPlatformHelpers(ITEMGUID_S_LV_HoE_GodPlatformHelper_001_2e85d53c-afb5-4ea1-8432-2b92997e2e35);
DB_LV_HoE_GodPlatformHelpers(ITEMGUID_S_LV_HoE_GodPlatformHelper_002_7e41d042-67ac-4767-bac8-328b7c139b96);
DB_LV_HoE_GodPlatformHelpers(ITEMGUID_S_LV_HoE_GodPlatformHelper_003_d6b35b33-24a5-4036-b6b8-7b7004314789);
DB_LV_HoE_GodPlatformHelpers(ITEMGUID_S_LV_HoE_GodPlatformHelper_004_a9bfcbd9-48f9-4ef0-bb5a-ab4e826426c1);
DB_LV_HoE_GodPlatformHelpers(ITEMGUID_S_LV_HoE_GodPlatformHelper_005_530d70c6-3745-40d7-8572-630ae8f069e4);
DB_LV_HoE_GodPlatformHelpers(ITEMGUID_S_LV_HoE_GodPlatformHelper_006_345e9c66-adb2-4af3-8d96-5a7032a3543b);
DB_LV_HoE_GodPlatformHelpers(ITEMGUID_S_LV_HoE_GodPlatformHelper_007_7c253eb4-cee5-41c8-b47e-44e712d54af6);
		
		
		
//LV_HoE_God_UndeadGod
DB_Dialogs(ITEMGUID_S_LV_HoE_ShipHeadInHoE_15132297-e9b6-40ea-ad96-ab6552d3b481,"LV_HoE_ShipHeadInHoE");
		
ProcTriggerRegisterForPlayers(TRIGGERGUID_S_LV_HoE_PathToTreeVB_Box_001_753d2745-b70c-41d0-a9db-f109bfd40b50);
ProcTriggerRegisterForPlayers(TRIGGERGUID_S_LV_HoE_PathToTreeVB_Box_002_275b5ad7-1539-4eb9-8694-450cfa4e5773);
ProcTriggerRegisterForPlayers(TRIGGERGUID_S_LV_HoE_LowerDeckEmptyVB_Box_987d660e-9747-4e93-aa2a-b5309da173a9);
ProcTriggerRegisterForPlayers(TRIGGERGUID_S_LV_HoE_MidDeckEmptyVB_Box_ca879256-c7b5-41e4-ac38-eefbb5961904);
		
Proc_PyramidBlockerTriggerAdd(TRIGGERGUID_S_LV_HoE_SUB_GodRoom_001_e937bd81-971f-4ae7-9ac9-829c8b61858f);
		
DB_LV_Companion_Ghosts((CHARACTERGUID)S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,(CHARACTERGUID)LV_RedPrince_Ghost_14a63143-b1a5-4d7d-8ed8-360f159e8d4d,"LV_RedPrince_Ghost");
DB_LV_Companion_Ghosts(CHARACTERGUID_S_Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,CHARACTERGUID_LV_Ifan_Ghost_8623e194-02bb-4fc9-855c-6f0da8a1c87a,"LV_Ifan_Ghost");
DB_LV_Companion_Ghosts(CHARACTERGUID_S_Player_Sebille_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,CHARACTERGUID_LV_Sebille_Ghost_fe763c4d-0687-40d8-ac0e-97a2e9b1d9b8,"LV_Sebille_Ghost");
DB_LV_Companion_Ghosts(CHARACTERGUID_S_Player_Lohse_bb932b13-8ebf-4ab4-aac0-83e6924e4295,CHARACTERGUID_LV_Lohse_Ghost_422c4340-f8aa-44f6-9a37-1868659bc2b7,"LV_Lohse_Ghost");
DB_LV_Companion_Ghosts(CHARACTERGUID_S_Player_Beast_f25ca124-a4d2-427b-af62-df66df41a978,CHARACTERGUID_LV_Beast_Ghost_0b6c190c-305f-4fc5-922c-99f0bb087d3a,"LV_Beast_Ghost");
DB_LV_Companion_Ghosts(CHARACTERGUID_S_Player_Fane_02a77f1f-872b-49ca-91ab-32098c443beb,CHARACTERGUID_LV_Fane_Ghost_43619c0e-dea6-4d90-b1a7-127e7542a662,"LV_Fane_Ghost");
		
DB_Companion_FixatedFlag((CHARACTERGUID)CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"GLO_RedPrince_Avatar");
DB_Companion_FixatedFlag(CHARACTERGUID_S_Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"GLO_Ifan_Avatar");
DB_Companion_FixatedFlag(CHARACTERGUID_S_Player_Sebille_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,"GLO_Sebille_Avatar");
DB_Companion_FixatedFlag(CHARACTERGUID_S_Player_Lohse_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"GLO_Lohse_Avatar");
DB_Companion_FixatedFlag(CHARACTERGUID_S_Player_Beast_f25ca124-a4d2-427b-af62-df66df41a978,"GLO_Beast_Avatar");
DB_Companion_FixatedFlag(CHARACTERGUID_S_Player_Fane_02a77f1f-872b-49ca-91ab-32098c443beb,"GLO_Fane_Avatar");
KBSECTION
IF
CharacterEnteredTrigger(_player,TRIGGERGUID_TESTEVENTT_f22bb6e3-810b-47ba-a19d-7d8cab2cd9f9)
THEN
ObjectSetFlag(_player,"QuestUpdate_TheTimeWeavers_HoEArrival");
AutoSave();

//Player talks to Deer and accepts quest
IF
ObjectFlagSet("QuestUpdate_TheTimeWeavers_MetDeer",_Speaker,_)
THEN
CharacterTeleportPartiesToTrigger(TRIGGERGUID_DC_HoE_Main_RedPyramid_5117b06d-7a75-4cf6-adb5-b0df88d1fe32,"DC_HoE_Main_Arrival");
ItemTemplateAddTo("ITEMGUID_Time_Worn_MasterKey_d106538c-48a4-4119-a5a1-aa1f932b5df1",_speaker,1);
ObjectSetFlag(_Speaker,"QuestUpdate_TheTimeWeavers_DeerTeleportedMe");

//Player arrives at Deer
IF
CharacterEnteredTrigger(_player,TRIGGERGUID_DC_HoE_Main_AlmostOut_6e34c380-9abd-4442-9561-e7f5bb00c503)
THEN
ObjectSetFlag(_player,"QuestUpdate_TheTimeWeavers_HoEMainExit");
ObjectSetFlag(_Player,"FTJ_LV_StartHoELevel");
AutoSave();

//Set God positions and status after movie

IF
CharacterEnteredTrigger(_Player,TRIGGERGUID_DC_ArrivedHoEGods_32da3a4e-6f68-4497-9962-38806460d703)
AND
DB_LV_HoE_DeadGods((CHARACTERGUID)_God)
THEN
ActivatePersistentLevelTemplate(ce8c7fa1-9f7e-4d22-8902-e0535f0f8f85);
CharacterSetForceSynch(_God,1);
CharacterSetAnimationOverride(_God,"Hung_04_Loop");
CharacterSetForceSynch(_God,0);
CharacterUseItem(_God,ITEMGUID_S_LV_HoE_SpiritTree_02bda965-05ae-4be8-8400-2c58a68490a0,"LV_HoE_Gods_SitFinished");
ApplyStatus(_God,"CURSED",-1.0,1);
ProcCharacterDisableAllCrimes(_God);

IF
CharacterLeftTrigger(_Player,TRIGGERGUID_DC_ArrivedHoEGods_32da3a4e-6f68-4497-9962-38806460d703)
THEN
TriggerUnregisterForPlayers(TRIGGERGUID_DC_ArrivedHoEGods_32da3a4e-6f68-4497-9962-38806460d703);

//Reset God positions and status after leaving HoE Lost Path

IF
CharacterEnteredTrigger(_Player,TRIGGERGUID_DC_ReturnedToHoEMain_77d87513-0938-4b8c-8962-cf5e67b326a8)
AND
DB_LV_HoE_DeadGods((CHARACTERGUID)_God)
THEN
ActivatePersistentLevelTemplate(ce8c7fa1-9f7e-4d22-8902-e0535f0f8f85);
CharacterSetForceSynch(_God,1);
CharacterSetAnimationOverride(_God,"Hung_04_Loop");
CharacterSetForceSynch(_God,0);
CharacterUseItem(_God,ITEMGUID_S_LV_HoE_SpiritTree_02bda965-05ae-4be8-8400-2c58a68490a0,"LV_HoE_Gods_SitFinished");
ApplyStatus(_God,"CURSED",-1.0,1);
ProcCharacterDisableAllCrimes(_God);
CharacterAddSourcePoints(_Player,1);
TriggerSetAtmosphere(TRIGGERGUID_DC_ReturnedToHoEMain_77d87513-0938-4b8c-8962-cf5e67b326a8,"ad2432cd-761d-43ed-9e88-656c86460275");
AutoSave();

IF
CharacterLeftTrigger(_Player,TRIGGERGUID_DC_ReturnedToHoEMain_77d87513-0938-4b8c-8962-cf5e67b326a8)
AND
DB_IsPlayer(_Player)
THEN
TriggerUnregisterForPlayers(TRIGGERGUID_DC_ReturnedToHoEMain_77d87513-0938-4b8c-8962-cf5e67b326a8);

IF
CharacterUsedSkillOnTarget((CHARACTERGUID)_Player,(CHARACTERGUID)_God,"Target_Bless",_)
AND
DB_LV_HoE_DeadGods(_God)
THEN
CharacterAddSourcePoints(_Player,1);
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "__Start"
