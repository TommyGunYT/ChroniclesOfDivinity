Version 1
SubGoalCombiner SGC_AND
INITSECTION

KBSECTION
IF
CharacterEnteredTrigger(_Player,TRIGGERGUID_DC_BeachWar_fc62c727-f90a-47a6-adb7-6cf443d4f0fb)
THEN
MusicPlayGeneral("Arx_end_Fight_part_02");
SetCanFight(_Player,0);
SetCanJoinCombat(_Player, 0);
SetFaction(CHARACTERGUID_S_DC_Magister3_6482cf0b-ab4b-4a65-bcca-f1956cedab90,"Arena_TeamA");
SetFaction(CHARACTERGUID_S_DC_Magister2_0f6ad116-9f90-433e-b697-1cb2a9fa4191,"Arena_TeamA");
SetFaction(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7,"Arena_TeamA");
SetFaction(CHARACTERGUID_S_DC_MagisterBeach_e671e075-5bd0-445a-a520-4363e12760f3,"Arena_TeamA");
SetFaction(CHARACTERGUID_S_DC_Paladin2_6f79e1bd-3295-477d-b48b-dbbf725b844f,"Arena_TeamB");
SetFaction(CHARACTERGUID_S_DC_Paladin1_ce458774-75f0-45c6-aa09-ff6a3f196427,"Arena_TeamB");
SetFaction(CHARACTERGUID_S_DC_Paladin_6_0ae453fe-3127-4474-aff5-5b5bbed98ba5,"Arena_TeamB");
SetFaction(CHARACTERGUID_S_DC_Paladin3_ef585a52-48ff-4d61-a03e-c09e365c631e,"Arena_TeamB");
SetFaction(CHARACTERGUID_S_DC_PaladinBeach_1b999608-53ad-4f58-bf38-38c096d50817,"Arena_TeamB");
ApplyStatus(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7,"BLEEDING",-1.0,1);
ApplyStatus(CHARACTERGUID_S_Magister_Andre_22cbc993-515a-4dcc-b5f7-55e04f0e630f,"CRIPPLED",-1.0,1);
GlobalSetFlag("DC_FM_Intro");

IF
CharacterReceivedDamage(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7)
AND
CharacterGetHitpointsPercentage(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7,_Percentage)
AND
_Percentage <= 50
AND
GetPosition(TRIGGERGUID_DC_Infernaltrigger_a980ff17-7db7-49e7-be1f-79595e971e71,_X,_Y,_Z)
THEN
CharacterFlushQueue(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7);
JumpToTurn(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7);
CharacterSetImmortal(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7,1);
RemoveHarmfulStatuses(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7);
CharacterAddSkill(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7,"ProjectileStrike_InfernalMeteors");
CharacterAddAbility(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7,"Pyrokinetic",25);
CharacterUseSkillAtPosition(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7,"ProjectileStrike_InfernalMeteors",_X,_Y,_Z,1,1);
TimerLaunch("BurningWarFJM",5000);

IF
TimerFinished("BurningWarFJM")
AND
GetPosition(ITEMGUID_S_DC_BatteringRamBeach_a26e93f0-8579-4240-ad95-4a236a3c557b,_X,_Y,_Z)
THEN
ItemDestroy(ITEMGUID_S_DC_BatteringRamBeach_a26e93f0-8579-4240-ad95-4a236a3c557b);
PlayScaledEffectAtPosition("RS3_FX_GP_Impacts_Wood_01", 7.0, _X, _Y, _Z);
TimerLaunch("BurningWarFJM3",5000);
GlobalSetFlag("AndreCallingForHelp");

IF
TimerFinished("BurningWarFJM3")
THEN
CharacterSetImmortal(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7,0);
CharacterDie(CHARACTERGUID_S_DC_Paladin2_6f79e1bd-3295-477d-b48b-dbbf725b844f,0,"Incinerate");
CharacterDie(CHARACTERGUID_S_DC_Magister3_6482cf0b-ab4b-4a65-bcca-f1956cedab90,0,"Incinerate");
CharacterDie(CHARACTERGUID_S_DC_Magister2_0f6ad116-9f90-433e-b697-1cb2a9fa4191,0,"Incinerate");
CharacterDie(CHARACTERGUID_S_DC_Magister3_e25e6f18-f06b-4317-a8da-8ba2511c1fd7,0,"Incinerate");
CharacterDie(CHARACTERGUID_S_DC_MagisterBeach_e671e075-5bd0-445a-a520-4363e12760f3,0,"Incinerate");
CharacterDie(CHARACTERGUID_S_DC_Paladin1_ce458774-75f0-45c6-aa09-ff6a3f196427,0,"Incinerate");
CharacterDie(CHARACTERGUID_S_DC_Paladin_6_0ae453fe-3127-4474-aff5-5b5bbed98ba5,0,"Incinerate");
CharacterDie(CHARACTERGUID_S_DC_Paladin3_ef585a52-48ff-4d61-a03e-c09e365c631e,0,"Incinerate");
CharacterDie(CHARACTERGUID_S_DC_PaladinBeach_1b999608-53ad-4f58-bf38-38c096d50817,0,"Incinerate");
TimerLaunch("BurningWarFJM2",2000);

IF
TimerFinished("BurningWarFJM2")
AND
GetPosition(ITEMGUID_S_DeathFogBattel_Init_dbdeaa58-eee9-4079-ba27-2683edc5012d,_X,_Y,_Z)
THEN
CreateExplosionAtPosition(_X,_Y,_Z,"Projectile_EnemyFireball",20);
CreateSurface(S_DFSpawn_5_dbf28f56-2473-46d2-a798-1d0c05c59a94,"Deathfog", 12.0, -1.0);
TimerLaunch("BurningWarFJM4",5000);

IF
TimerFinished("BurningWarFJM4")
AND
DB_IsPlayer(_Player)
THEN
CharacterDie(CHARACTERGUID_S_DC_SkeletonGirlBeach_f06d3f4a-67c6-4af4-b0fc-dfbb0767d1b5,0,"Incinerate");
CreatePuddle(S_DC_SkeletonGirlBeach_f06d3f4a-67c6-4af4-b0fc-dfbb0767d1b5,"SurfaceDeathfogCloud",200,300,30,50,0.1);
SetCanFight(_Player,1);
SetCanJoinCombat(_Player,1);

IF
CharacterEnteredTrigger(_Player,TRIGGERGUID_DC_AndreDialogue_0fec2a09-c4eb-480d-b0a4-6d56a988dcf3)
AND
DB_IsPlayer(_Player)
AND
PartyGetFlag(_Player,"MagisterAndreTalkedTo",0)
THEN
Proc_StartDialog(0,"FM_Andre",CHARACTERGUID_S_Magister_Andre_22cbc993-515a-4dcc-b5f7-55e04f0e630f,_Player);
PartySetFlag(_Player,"MagisterAndreTalkedTo");

//Leaves Magister Andre to die

IF
GlobalFlagSet("LeaveAndreToDie")
THEN
CharacterSetAnimationOverride(CHARACTERGUID_S_Magister_Andre_22cbc993-515a-4dcc-b5f7-55e04f0e630f,"Cower_01");
TimerLaunch("LeaveAndreToDie",5000);

IF
TimerFinished("LeaveAndreToDie")
THEN
CreatePuddle(ITEMGUID_S_DeathFogSpawner2_45754a9c-8d1d-4521-bba5-7e886e81b117,"SurfaceDeathfogCloud",200,300,30,50,0.1);
TimerLaunch("LeaveAndreToDie2",3000);

IF
TimerFinished("LeaveAndreToDie2")
THEN
CreatePuddle(ITEMGUID_S_DeathFogSpawner3_e057de79-a3a2-4339-8e1d-3df4a0603af7,"SurfaceDeathfogCloud",200,300,48,65,0.1);
PlaySound(CHARACTERGUID_S_Magister_Andre_22cbc993-515a-4dcc-b5f7-55e04f0e630f,"Vocals_Combat");


// Tries to help Andre

IF
GlobalFlagSet("TryToHelpAndre")
THEN
CharacterSetAnimationOverride(CHARACTERGUID_S_Magister_Andre_22cbc993-515a-4dcc-b5f7-55e04f0e630f,"Cower_01");
TimerLaunch("TryToHelpAndre",12000);

IF
TimerFinished("TryToHelpAndre")
THEN
CreatePuddle(ITEMGUID_S_DeathFogSpawner2_45754a9c-8d1d-4521-bba5-7e886e81b117,"SurfaceDeathfogCloud",200,300,30,50,0.1);
TimerLaunch("TryToHelpAndre2",20000);

IF
TimerFinished("TryToHelpAndre2")
THEN
CreatePuddle(ITEMGUID_S_DeathFogSpawner3_e057de79-a3a2-4339-8e1d-3df4a0603af7,"SurfaceDeathfogCloud",200,300,45,65,0.1);
PlaySound(CHARACTERGUID_S_Magister_Andre_22cbc993-515a-4dcc-b5f7-55e04f0e630f,"Vocals_Combat");

IF
TimerFinished("BurningWarFJM")
AND
GlobalGetFlag("AndreCallingForHelp",1)
THEN
DisplayText(CHARACTERGUID_S_Magister_Andre_22cbc993-515a-4dcc-b5f7-55e04f0e630f,"Somebody! Help!");
TimerLaunch("AndreCallingForHelp2",8000);

IF
TimerFinished("AndreCallingForHelp2")
AND
GlobalGetFlag("AndreCallingForHelp",1)
THEN
DisplayText(CHARACTERGUID_S_Magister_Andre_22cbc993-515a-4dcc-b5f7-55e04f0e630f,"I don't want to die!");
TimerLaunch("AndreCallingForHelp3",9000);

IF
TimerFinished("AndreCallingForHelp3")
AND
GlobalGetFlag("AndreCallingForHelp",1)
THEN
DisplayText(CHARACTERGUID_S_Magister_Andre_22cbc993-515a-4dcc-b5f7-55e04f0e630f,"*Prays and pleads to Lucian*");
TimerLaunch("AndreCallingForHelp4",10000);

IF
TimerFinished("AndreCallingForHelp4")
AND
GlobalGetFlag("AndreCallingForHelp",1)
THEN
DisplayText(CHARACTERGUID_S_Magister_Andre_22cbc993-515a-4dcc-b5f7-55e04f0e630f,"Anybody! The fog...! It's coming closer!");
TimerLaunch("AndreCallingForHelp2",10000);

IF
DialogStarted("FM_Andre",_)
THEN
GlobalClearFlag("AndreCallingForHelp");
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "DC_FortMisery"
