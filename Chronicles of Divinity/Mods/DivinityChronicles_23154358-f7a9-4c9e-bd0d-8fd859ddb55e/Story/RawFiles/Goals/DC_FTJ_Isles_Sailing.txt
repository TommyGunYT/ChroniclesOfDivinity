Version 1
SubGoalCombiner SGC_AND
INITSECTION
//SetOnStage(Boat on Fort Joy with Brandon),1)
SetOnStage(ITEMGUID_S_DC_BoardingBoat_ShrineIsle_db06b8de-0f6e-45b1-9774-dbbfb205a21c,1); //Launch: Make 0
SetOnStage(ITEMGUID_S_DC_BoardingBoat_DragonIsle_46af6441-3529-4f1d-bdd2-f1854ccd1ebf,0);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_PirateIsle_d01adccc-23c0-40e1-8993-7eda1cda6f11,0);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_SeekerIsle_0a1ebbd5-d914-4bfc-aad9-fce0daabf4b1,0);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_HandsomeIsle_d8ca18d3-c57e-454e-a2b9-4835dbc8d25a,0);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_WaveDancer_b6f1f853-587a-4382-9410-48a2382a3633,0);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_SecretAltarEntrance_ad8224a2-d00d-45c4-8927-30751db53978,0);



//DOCKING AGENCY - (Boarding Area | Docked Ship | PlayerShip Start location | Player Dock Landing | Cam)
DB_DCBoatAgency(TRIGGERGUID_DC_BoardingArea_DragonIsle_38a3b7d2-0a68-48fe-ae4c-d0ae933a0a87, ITEMGUID_S_DC_BoardingBoat_DragonIsle_46af6441-3529-4f1d-bdd2-f1854ccd1ebf, TRIGGERGUID_DC_FTJI_BoatStart_DragonIsle_80182983-6e1e-4d4d-8c78-47d980c5968b,TRIGGERGUID_DC_OffBoatLanding_DragonIsle_047ed66f-1895-422e-aaf8-859ab021ba36,"DC_Cam_DragonIsle");
DB_DCBoatAgency(TRIGGERGUID_DC_BoardingArea_ShrineIsle_d8706271-7a61-4265-b356-70d79be4dfb0, ITEMGUID_S_DC_BoardingBoat_ShrineIsle_db06b8de-0f6e-45b1-9774-dbbfb205a21c, TRIGGERGUID_DC_FTJI_BoatStart_MainIsleBeach_7b576108-d967-4564-b3be-cf530e32f7a0,TRIGGERGUID_DC_TP_FTJ_Isles_BeachMain_fda011da-df2c-4696-868b-a9fe5591df55,"DC_Cam_ShrineIsle");
DB_DCBoatAgency(TRIGGERGUID_DC_BoardingArea_PirateIsle_f540c454-147a-4fc6-b9a1-fe7d54771871, ITEMGUID_S_DC_BoardingBoat_PirateIsle_d01adccc-23c0-40e1-8993-7eda1cda6f11, TRIGGERGUID_DC_FTJI_BoatStart_PirateIsle_c0379010-e627-4ed0-a270-6658e799fb98,TRIGGERGUID_DC_OffBoatLanding_PirateIslandA_e378d18c-9974-4a62-a9fa-793db48e72ad,"DC_Cam_PirateIsle");
DB_DCBoatAgency(TRIGGERGUID_DC_BoardingArea_SeekerIsle_9f81c387-17ac-44d1-8444-d4d703d8f61f, ITEMGUID_S_DC_BoardingBoat_SeekerIsle_0a1ebbd5-d914-4bfc-aad9-fce0daabf4b1, TRIGGERGUID_DC_FTJI_BoatStart_SeekerIsle_6281f30c-1e4a-4c6d-a892-c58ee578145b,TRIGGERGUID_DC_OffBoatLanding_SeekerIsle_c3ed94fe-edc4-431c-8fd1-9450fc3df262,"DC_Cam_SeekerIsle");
DB_DCBoatAgency(TRIGGERGUID_DC_BoardingArea_HandsomeIsle_30775e81-0993-41d2-adb8-604830d2054a, ITEMGUID_S_DC_BoardingBoat_HandsomeIsle_d8ca18d3-c57e-454e-a2b9-4835dbc8d25a, TRIGGERGUID_DC_FTJI_BoatStart_HandsomeIsle_4491c28a-1a38-418b-8ab2-749ea8197b9d,TRIGGERGUID_DC_OffBoatLanding_HandsomeIsle_43902be8-131f-4eca-b4db-47d51d608f38,"DC_Cam_HandsomeIsle");
DB_DCBoatAgency(TRIGGERGUID_DC_BoardingArea_WaveDancer_0826c775-28e7-4ab4-8653-2a69af73b43b, ITEMGUID_S_DC_BoardingBoat_WaveDancer_b6f1f853-587a-4382-9410-48a2382a3633, TRIGGERGUID_DC_FTJI_BoatStart_WaveDancer_b42ca4ca-4450-4c34-91f3-ed26f71719c7,TRIGGERGUID_DC_OffBoatLanding_WaveDancer_f503545a-8c5a-465b-9c82-c22f76911ba9,"DC_Cam_WaveDancer");
DB_DCBoatAgency(TRIGGERGUID_DC_BoardingArea_SecretAltarEntrance_4ddf5b99-8521-4406-a995-aac26343abad, ITEMGUID_S_DC_BoardingBoat_SecretAltarEntrance_ad8224a2-d00d-45c4-8927-30751db53978, TRIGGERGUID_DC_FTJI_BoatStart_SecretAltarEntrance_f73dd4af-22c8-4a4a-9157-2b4f536fb7d6,TRIGGERGUID_DC_OffBoatLanding_SecretAltarEntrance_b04c08dd-a9ef-4ec6-bd0d-7923f9fbd754,"DC_Cam_SecretAltarEntrance");

//PLAYER BOATS
DB_DCPlayerBoat(CHARACTERGUID_DC_PlayerBoat_83985725-9cb5-479d-9284-5cc75d0520a8);

//DOCKING AREAS (SPELL)
DB_DCDockingSpell(TRIGGERGUID_DC_DockingTrigger_DragonIsland_26bb9b4c-70a2-49c2-baed-c8217a90758f);
DB_DCDockingSpell(TRIGGERGUID_DC_DockingTrigger_MainBeach_9d776048-1f28-4856-90de-d958ef2e4825);
DB_DCDockingSpell(TRIGGERGUID_DC_DockingTrigger_PirateIsle_16cfed21-b973-40f5-9ead-3a0c3c853fa5);
DB_DCDockingSpell(TRIGGERGUID_DC_DockingTrigger_SeekerIsle_e1f4b741-bfb1-44ab-a900-a86c28df72e8);
DB_DCDockingSpell(TRIGGERGUID_DC_DockingTrigger_HandsomeIsle_cc20c8ef-058e-436e-be2f-b533d2b8429e);
DB_DCDockingSpell(TRIGGERGUID_DC_DockingTrigger_Wavedancer_38ed337e-3a4a-4bb6-b7b5-f14176f2dc4d);
DB_DCDockingSpell(TRIGGERGUID_DC_DockingTrigger_SecretAltarEntrance_265b8a9b-1f5f-4d6d-ade9-3638a3c274ea);


KBSECTION
//REGION SAILING SYSTEM
IF
CharacterEnteredTrigger(_Player, TRIGGERGUID_DC_DockingTrigger_SecretAltarEntrance_265b8a9b-1f5f-4d6d-ade9-3638a3c274ea)
AND
GlobalGetFlag("BeenToSecretAltarEntranceArea",0)
THEN
GlobalSetFlag("BeenToSecretAltarEntranceArea");

IF
CharacterUsedItem(_Player,_DockShip)
AND
DB_IsPlayer(_Player)
AND
DB_DCPlayerBoat(_PlayerShip)
AND
DB_DCBoatAgency(_DockLoc, _DockShip, _PlayerShipStart, _LandingStart, _LandCam)
AND
GlobalGetFlag("BeenToSecretAltarEntranceArea",0)
THEN
SetOnStage(ITEMGUID_S_DC_AltarPressurePlate_A_06e48943-f1d5-448a-a2a7-4b463d28c9c1, 0);
SetOnStage(ITEMGUID_S_DC_AltarPressurePlate_B_f0584303-f72d-46b6-81fb-73a81704e6df, 0);
SetOnStage(ITEMGUID_S_DC_AltarPressurePlate_C_31305832-c732-49a9-89a7-3f8be794a30e, 0);

IF
CharacterUsedItem(_Player,_DockShip)
AND
DB_IsPlayer(_Player)
AND
DB_DCPlayerBoat(_PlayerShip)
AND
DB_DCBoatAgency(_DockLoc, _DockShip, _PlayerShipStart, _LandingStart, _LandCam)
AND
ObjectIsInTrigger(_Player, (TRIGGERGUID)_DockLoc, 1)
THEN
TeleportTo((CHARACTERGUID)_PlayerShip,_PlayerShipStart);
SetOnStage((CHARACTERGUID)_PlayerShip,1);
CharacterMakePlayer((CHARACTERGUID)_PlayerShip);
CharacterAddToParty((CHARACTERGUID)_PlayerShip,(CHARACTERGUID)_Player);
MakePlayerActive((CHARACTERGUID)_PlayerShip);
TeleportTo((CHARACTERGUID)_Player, TRIGGERGUID_DC_TP_PlayerBoat_LowerDeck_ab21c5b5-c251-4415-935b-8bc31e3c6679);
CharacterRemoveFromParty((CHARACTERGUID)_Player);
SetCameraDistanceOverride(85.0);
CharacterAddSkill((CHARACTERGUID)_PlayerShip,"Shout_GoToLowerDeck");
GlobalSetFlag("PlayerIsBoat");
SetTag((CHARACTERGUID)_PlayerShip, "PlayerSailor");
DB_ShipOwner((CHARACTERGUID)_Player);
DB_IsPlayer((CHARACTERGUID)_PlayerShip);
Proc_DCPlayersToLowerDeck();

PROC
Proc_DCPlayersToLowerDeck()
AND
DB_IsPlayer(_PartyPlayer)
AND
DB_IsPlayer((CHARACTERGUID)_PlayerShip)
AND
DB_DCBoatAgency(_DockLoc, _DockShip, _PlayerShipStart, _LandingStart, _LandCam)
AND
ObjectIsInTrigger(_PartyPlayer, (TRIGGERGUID)_DockLoc, 1)
AND
IsTagged(_PartyPlayer, "PlayerSailor", 0)
THEN
TeleportTo((CHARACTERGUID)_PartyPlayer, TRIGGERGUID_DC_TP_PlayerBoat_LowerDeck_ab21c5b5-c251-4415-935b-8bc31e3c6679);
CharacterRemoveFromParty((CHARACTERGUID)_PartyPlayer);
DB_DCDeckPartyCharacters((CHARACTERGUID)_PartyPlayer);

IF
CharacterUsedSkill(_Ship,"Shout_Docking","")
AND
DB_ShipOwner((CHARACTERGUID)_Player)
AND
DB_DCPlayerBoat(_PlayerShip)
AND
DB_DCBoatAgency(_DockLoc, _DockShip, _PlayerShipStart, _LandingStart, _LandCam)
AND
DB_IsPlayer(_Player)
AND
DB_DCDeckPartyCharacters((CHARACTERGUID)_PartyPlayer)
AND
ObjectIsInTrigger(_PlayerShip, (TRIGGERGUID)_DockLoc, 1)
AND
CharacterGetReservedUserID((CHARACTERGUID)_Player, _User)
THEN
TeleportTo((CHARACTERGUID)_Player, _LandingStart);
TeleportTo((CHARACTERGUID)_PartyPlayer, _LandingStart);
CharacterMakePlayer((CHARACTERGUID)_Player);
CharacterAddToParty((CHARACTERGUID)_Player,_Ship);
TeleportTo((CHARACTERGUID)_Player, _LandingStart);
CharacterMakePlayer((CHARACTERGUID)_PartyPlayer);
CharacterAddToParty((CHARACTERGUID)_PartyPlayer,_Ship);
MakePlayerActive((CHARACTERGUID)_PartyPlayer);
CharacterAssignToUser(_User, (CHARACTERGUID)_Player);
CharacterAssignToUser(_User, (CHARACTERGUID)_PartyPlayer);
SetCameraDistanceOverride(20.0);
CharacterRemoveSkill(_Ship,"Shout_GoToLowerDeck");
CharacterRemoveFromParty(_Ship);
SetOnStage(_Ship,0);
CameraActivate(_Player,_LandCam,0.0,0,0,0);
NOT DB_ShipOwner((CHARACTERGUID)_Player);
NOT DB_IsPlayer((CHARACTERGUID)_PlayerShip);
NOT DB_DCDeckPartyCharacters((CHARACTERGUID)_PartyPlayer);
GlobalSetFlag("DC_ShowDockedBoats");
GlobalClearFlag("PlayerIsBoat");
ClearTag((CHARACTERGUID)_PlayerShip, "PlayerSailor");

//REGION DOCKING SPELL
IF
CharacterEnteredTrigger(_Player,(TRIGGERGUID)_DockingArea)
AND
DB_DCDockingSpell(_DockingArea)
AND
GlobalGetFlag("PlayerIsBoat",1)
THEN
CharacterAddSkill(_Player,"Shout_Docking");

IF
CharacterLeftTrigger(_Player,(TRIGGERGUID)_DockingArea)
AND
DB_DCDockingSpell(_DockingArea)
THEN
CharacterRemoveSkill(_Player,"Shout_Docking");
//END_REGION




//END_REGION


//REGION GO TO LOWER DECK

//Using Go to Lower Deck Spell
IF
CharacterUsedSkill(_Ship,"Shout_GoToLowerDeck","")
AND
DB_ShipOwner((CHARACTERGUID)_Player)
AND
DB_DCPlayerBoat(_PlayerShip)
AND
DB_DCBoatAgency(_DockLoc, _DockShip, _PlayerShipStart, _LandingStart, _LandCam)
AND
DB_IsPlayer(_Player)
AND
DB_DCDeckPartyCharacters((CHARACTERGUID)_PartyPlayer)
AND
GlobalGetFlag("PlayerIsBoat",1)
AND
CharacterGetReservedUserID((CHARACTERGUID)_Player, _User)
AND
GetPosition(_Ship,_ShipX,_ShipY,_ShipZ)
THEN
CharacterRemoveSkill(_Player,"Shout_Docking");
CharacterMakePlayer((CHARACTERGUID)_Player);
CharacterAddToParty((CHARACTERGUID)_Player,_Ship);
CharacterAddToParty((CHARACTERGUID)_PartyPlayer,_Ship);
MakePlayerActive((CHARACTERGUID)_Player);
CharacterAssignToUser(_User, (CHARACTERGUID)_Player);
SetCameraDistanceOverride(20.0);
CharacterRemoveFromParty(_Ship);
CameraActivate(_Player,"DC_Cam_LowerDeck",0.0,0,0,0);
DB_ShipLocation(_ShipX,_ShipY,_ShipZ);
NOT DB_ShipOwner((CHARACTERGUID)_Player);
NOT DB_IsPlayer((CHARACTERGUID)_PlayerShip);
GlobalClearFlag("PlayerIsBoat");

//Stairs to go back up to top deck
IF
CharacterUsedItem(_Player, ITEMGUID_DC_PlayerBoat_LowerDeck_Stairs_DC_PlayerBoat_LowerDeck_000_b79df65c-028b-8403-55bb-8e90a3ddba59)
AND
DB_IsPlayer(_Player)
AND
DB_DCPlayerBoat(_PlayerShip)
AND
DB_DCBoatAgency(_DockLoc, _DockShip, _PlayerShipStart, _LandingStart, _LandCam)
AND
DB_ShipLocation(_ShipX,_ShipY,_ShipZ)
AND
DB_DCDeckPartyCharacters((CHARACTERGUID)_PartyPlayer)
AND
GlobalGetFlag("PlayerIsBoat", 0)
AND
CharacterIsInPartyWith((CHARACTERGUID)_PlayerShip, _Player, 0)
AND
ObjectIsInTrigger(_PartyPlayer, TRIGGERGUID_DC_PlayerBoat_LowerDecks_Check_2bbdf693-8636-4bbd-9f47-6338233a6c17, 1)
THEN
TeleportToPosition((CHARACTERGUID)_PlayerShip,_ShipX,_ShipY,_ShipZ,"",0);
SetOnStage((CHARACTERGUID)_PlayerShip,1);
CharacterMakePlayer((CHARACTERGUID)_PlayerShip);
CharacterAddToParty((CHARACTERGUID)_PlayerShip,(CHARACTERGUID)_Player);
MakePlayerActive((CHARACTERGUID)_PlayerShip);
TeleportTo((CHARACTERGUID)_Player,TRIGGERGUID_DC_TP_PlayerBoat_LowerDeck_ab21c5b5-c251-4415-935b-8bc31e3c6679);
CharacterRemoveFromParty((CHARACTERGUID)_Player);
CharacterRemoveFromParty((CHARACTERGUID)_PartyPlayer);
SetCameraDistanceOverride(85.0);
DB_ShipOwner((CHARACTERGUID)_Player);
DB_IsPlayer((CHARACTERGUID)_PlayerShip);
NOT DB_ShipLocation(_ShipX,_ShipY,_ShipZ);
GlobalSetFlag("PlayerIsBoat");
//END_REGION

IF
CharacterUsedItem(_Player, ITEMGUID_DC_PlayerBoat_LowerDeck_Stairs_DC_PlayerBoat_LowerDeck_000_b79df65c-028b-8403-55bb-8e90a3ddba59)
AND
GlobalGetFlag("PlayerIsBoat", 1)
THEN
DisplayText(_Player, "I shouldn't disturb the captain.");


//REGION DOCKING BOAT VISIBILITY
//HIDE
IF
GlobalFlagSet("PlayerIsBoat")
THEN
SetOnStage(ITEMGUID_S_DC_PlayerBoat_MainBeach_000_46af6441-3529-4f1d-bdd2-f1854ccd1ebf,0);
SetOnStage(ITEMGUID_S_DC_PlayerBoat_MainBeach_db06b8de-0f6e-45b1-9774-dbbfb205a21c,0);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_PirateIsle_d01adccc-23c0-40e1-8993-7eda1cda6f11,0);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_SeekerIsle_0a1ebbd5-d914-4bfc-aad9-fce0daabf4b1,0);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_HandsomeIsle_d8ca18d3-c57e-454e-a2b9-4835dbc8d25a,0);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_WaveDancer_b6f1f853-587a-4382-9410-48a2382a3633,0);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_SecretAltarEntrance_ad8224a2-d00d-45c4-8927-30751db53978,0);

//SHOW
IF
GlobalFlagSet("DC_ShowDockedBoats")
THEN
SetOnStage(ITEMGUID_S_DC_PlayerBoat_MainBeach_000_46af6441-3529-4f1d-bdd2-f1854ccd1ebf,1);
SetOnStage(ITEMGUID_S_DC_PlayerBoat_MainBeach_db06b8de-0f6e-45b1-9774-dbbfb205a21c,1);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_PirateIsle_d01adccc-23c0-40e1-8993-7eda1cda6f11,1);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_SeekerIsle_0a1ebbd5-d914-4bfc-aad9-fce0daabf4b1,1);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_HandsomeIsle_d8ca18d3-c57e-454e-a2b9-4835dbc8d25a,1);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_WaveDancer_b6f1f853-587a-4382-9410-48a2382a3633,1);
SetOnStage(ITEMGUID_S_DC_BoardingBoat_SecretAltarEntrance_ad8224a2-d00d-45c4-8927-30751db53978,1);
GlobalClearFlag("DC_ShowDockedBoats");
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "DC_Isles"
